<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ webstory.meta_title }} - QR Dada Web Story</title>
    <meta name="description" content="{{ webstory.meta_description }}">

    <!-- Canonical URL -->
    <link rel="canonical" href="{{ request.url }}">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:title" content="{{ webstory.meta_title }}">
    <meta property="og:description" content="{{ webstory.meta_description }}">
    {% if webstory.cover_image %}
    <meta property="og:image" content="{{ url_for('static', filename='uploads/webstories/' + webstory.cover_image, _external=True) }}">
    {% endif %}

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="{{ request.url }}">
    <meta name="twitter:title" content="{{ webstory.meta_title }}">
    <meta name="twitter:description" content="{{ webstory.meta_description }}">
    {% if webstory.cover_image %}
    <meta name="twitter:image" content="{{ url_for('static', filename='uploads/webstories/' + webstory.cover_image, _external=True) }}">
    {% endif %}

    <!-- Schema.org Article Markup -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": "{{ webstory.meta_title }}",
        "description": "{{ webstory.meta_description }}",
        {% if webstory.cover_image %}
        "image": {
            "@type": "ImageObject",
            "url": "{{ url_for('static', filename='uploads/webstories/' + webstory.cover_image, _external=True) }}",
            "width": 1080,
            "height": 1920,
            "caption": "{{ webstory.meta_title }}"
        },
        {% endif %}
        "datePublished": "{{ webstory.publish_date.isoformat() if webstory.publish_date else webstory.created_at.isoformat() }}",
        "dateModified": "{{ webstory.updated_at.isoformat() if webstory.updated_at else webstory.created_at.isoformat() }}",
        "author": {
            "@type": "Organization",
            "name": "QR Dada",
            "url": "{{ url_for('index', _external=True) }}"
        },
        "publisher": {
            "@type": "Organization",
            "name": "QR Dada",
            "url": "{{ url_for('index', _external=True) }}"
        },
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "{{ request.url }}"
        },
        "url": "{{ request.url }}"
    }
    </script>

    <!-- Google Fonts - Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #7c3aed;
            --secondary: #8b5cf6;
            --qrdada-gradient: linear-gradient(-45deg, #0ea5e9, #8b5cf6, #ec4899, #f97316);
        }

        /* Animated gradient background class */
        .gradient-bg {
            background: linear-gradient(-45deg, #0ea5e9, #8b5cf6, #ec4899, #f97316);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
            background: #000;
            overflow: hidden;
        }

        .story-viewer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
        }

        .story-container {
            position: relative;
            width: 100%;
            max-width: 480px;
            height: 100vh;
            background: #000;
            overflow: hidden;
        }

        .story-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            background-color: #000;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .story-slide.active {
            display: block;
        }

        .story-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            z-index: 15;
            padding: 1rem 1rem;
            color: #fff;
        }

        /* Navigation Menu Styles */
        .story-nav-menu {
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: #fff;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
            flex-shrink: 0;
        }

        .story-nav-menu:hover {
            background: rgba(124, 58, 237, 0.8);
        }

        .nav-dropdown {
            position: absolute;
            top: 60px;
            left: 1rem;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            width: 220px;
            padding: 0.5rem 0;
            display: none;
            z-index: 20;
        }

        .nav-dropdown.visible {
            display: block;
        }

        .nav-dropdown a {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            color: #374151;
            font-size: 0.875rem;
            text-decoration: none;
            transition: background 0.15s;
        }

        .nav-dropdown a:hover {
            background: #f3e8ff;
            color: var(--primary);
        }

        .nav-dropdown a i {
            width: 20px;
            margin-right: 10px;
            text-align: center;
        }

        .nav-dropdown-divider {
            height: 1px;
            background: #e5e7eb;
            margin: 0.5rem 0;
        }

        .nav-dropdown-title {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .story-progress {
            display: flex;
            gap: 4px;
            flex: 1;
        }

        .progress-bar {
            height: 3px;
            background: rgba(255, 255, 255, 0.3);
            flex: 1;
            border-radius: 2px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: #fff;
            width: 0%;
            transition: width 0.1s linear;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 3px;
            background: #fff;
            box-shadow: 0 0 6px rgba(255, 255, 255, 0.8);
        }

        .progress-bar.active .progress-fill {
            animation: progress 5s linear forwards;
        }

        .progress-bar.completed .progress-fill {
            width: 100%;
        }

        @keyframes progress {
            to { width: 100%; }
        }

        .story-close {
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: #fff;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
            flex-shrink: 0;
        }

        .story-close:hover {
            background: rgba(124, 58, 237, 0.8);
        }

        .story-content {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 10;
            pointer-events: none;
        }

        .story-heading {
            position: absolute;
            font-size: 24px;
            font-weight: 400;
            line-height: 1.3;
            color: #fff;
            text-align: center;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7);
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 12px;
            width: 85%;
            max-width: 95%;
            pointer-events: auto;
            /* Default centered position */
            left: 50%;
            bottom: 18%;
            transform: translateX(-50%);
            box-sizing: border-box;
            overflow: hidden;
            word-wrap: break-word;
        }

        .story-text {
            position: absolute;
            font-size: 16px;
            font-weight: 400;
            line-height: 1.5;
            color: #fff;
            text-align: center;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7);
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 12px;
            width: 85%;
            max-width: 95%;
            pointer-events: auto;
            /* Default centered position */
            left: 50%;
            bottom: 9%;
            transform: translateX(-50%);
            box-sizing: border-box;
            overflow: hidden;
            word-wrap: break-word;
        }

        /* List styles for story text and heading */
        .story-text ul,
        .story-heading ul {
            list-style-type: disc !important;
            list-style-position: inside;
            padding-left: 0.5rem;
            margin: 0.5rem 0;
            text-align: left;
        }

        .story-text ol,
        .story-heading ol {
            list-style-type: decimal !important;
            list-style-position: inside;
            padding-left: 0.5rem;
            margin: 0.5rem 0;
            text-align: left;
        }

        .story-text li,
        .story-heading li {
            display: list-item !important;
            margin-bottom: 0.25rem;
            line-height: 1.4;
        }

        .story-text ul ul,
        .story-heading ul ul {
            list-style-type: circle !important;
        }

        .story-text ul ul ul,
        .story-heading ul ul ul {
            list-style-type: square !important;
        }

        /* Link styles for story text and heading content */
        .story-text a,
        .story-heading a {
            color: #93c5fd !important;
            text-decoration: underline !important;
            text-underline-offset: 2px;
            transition: all 0.2s ease;
            cursor: pointer !important;
            pointer-events: auto !important;
            position: relative;
            z-index: 15;
            display: inline;
        }

        .story-text a:hover,
        .story-heading a:hover {
            color: #bfdbfe !important;
            text-decoration-thickness: 2px;
        }

        /* Bold and italic styles for story text and heading */
        .story-text strong,
        .story-heading strong,
        .story-text b,
        .story-heading b {
            font-weight: 700 !important;
        }

        .story-text i,
        .story-heading i,
        .story-text em,
        .story-heading em {
            font-style: italic !important;
        }

        /* Ensure story text and heading allow link clicks */
        .story-text,
        .story-heading {
            pointer-events: auto !important;
        }

        .story-text *,
        .story-heading * {
            pointer-events: auto !important;
        }

        .story-link {
            position: absolute;
            left: 50%;
            bottom: 3%;
            transform: translateX(-50%);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.35rem;
            background: #fff;
            color: var(--primary);
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
            pointer-events: auto;
        }

        .story-link:hover {
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 4px 4px 15px rgba(0, 0, 0, 0.6);
            color: var(--primary);
            background: #fff;
        }

        .story-link i {
            transition: transform 0.3s ease;
        }

        .story-link:hover i {
            transform: translateX(3px);
        }

        .story-navigation {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 35%;
            cursor: pointer;
            z-index: 5;
        }

        .nav-prev {
            left: 0;
        }

        .nav-next {
            right: 0;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(139, 92, 246, 0.3);
            border-top-color: #8b5cf6;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: #fff;
            margin-top: 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .story-container {
                max-width: 100%;
            }

            .story-heading {
                font-size: 20px;
                padding: 10px;
            }

            .story-text {
                font-size: 14px;
                padding: 10px;
            }

            .story-overlay {
                padding: 1.25rem 1rem;
            }
        }

        @media (max-width: 480px) {
            .story-heading {
                font-size: 18px;
                padding: 8px;
            }

            .story-text {
                font-size: 13px;
                padding: 8px;
            }

            .story-link {
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading Story...</div>
    </div>

    <!-- Story Viewer -->
    <div class="story-viewer">
        <div class="story-container">
            {% if webstory.slides %}
            {% for slide in webstory.slides %}
            {% if slide.status %}
            <div class="story-slide {% if loop.first %}active{% endif %}"
                 data-index="{{ loop.index0 }}"
                 style="background-image: url('{{ slide.image }}'); background-position: {{ slide.image_pos_x|default(50) }}% {{ slide.image_pos_y|default(50) }}%; background-size: {% if slide.image_zoom and slide.image_zoom != 100 %}{{ slide.image_zoom }}%{% else %}cover{% endif %};">
                <div class="story-header" >
                    <!-- Navigation Menu Button -->
                    <button class="story-nav-menu" id="navMenuBtn" onclick="event.stopPropagation(); toggleNavDropdown();">
                        <i class="fas fa-bars"></i>
                    </button>

                    <div class="story-progress">
                        {% for s in webstory.slides %}
                        {% if s.status %}
                        <div class="progress-bar {% if loop.first %}active{% endif %}">
                            <div class="progress-fill"></div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                    <button class="story-close" onclick="window.location.href='{{ url_for('public_webstories') }}'">
                        <i class="fas fa-times"></i>
                    </button>

                    <!-- Navigation Dropdown -->
                    <div class="nav-dropdown" id="navDropdown">
                        <a href="{{ url_for('index') }}">
                            <i class="fas fa-home"></i> Home
                        </a>
                        <a href="{{ url_for('public_blogs') }}">
                            <i class="fas fa-blog"></i> Blog
                        </a>
                        <a href="{{ url_for('public_webstories') }}">
                            <i class="fas fa-book-open"></i> Web Stories
                        </a>
                        <div class="nav-dropdown-divider"></div>
                        <div class="nav-dropdown-title">Our Services</div>
                        <a href="{{ url_for('service_qr_url') }}">
                            <i class="fas fa-link"></i> QR Code for URL
                        </a>
                        <a href="{{ url_for('service_qr_email') }}">
                            <i class="fas fa-envelope"></i> QR Code for Email
                        </a>
                        <a href="{{ url_for('service_qr_wifi') }}">
                            <i class="fas fa-wifi"></i> QR Code for WiFi
                        </a>
                        <a href="{{ url_for('service_qr_sms') }}">
                            <i class="fas fa-comment"></i> QR Code for SMS
                        </a>
                        <a href="{{ url_for('service_qr_event') }}">
                            <i class="fas fa-calendar"></i> QR Code for Event
                        </a>
                        <a href="{{ url_for('service_qr_call') }}">
                            <i class="fas fa-phone"></i> QR Code for Call
                        </a>
                        <a href="{{ url_for('service_qr_whatsapp') }}">
                            <i class="fab fa-whatsapp"></i> QR Code for WhatsApp
                        </a>
                        <a href="{{ url_for('service_qr_vcard') }}">
                            <i class="fas fa-address-card"></i> QR Code for vCard
                        </a>
                        <a href="{{ url_for('service_qr_text') }}">
                            <i class="fas fa-font"></i> QR Code for Text
                        </a>
                    </div>
                </div>

                <div class="story-content">
                    {% if slide.heading %}
                    <div class="story-heading" style="{% if slide.heading_bottom %}bottom: {{ slide.heading_bottom }};{% endif %}{% if slide.heading_left %}left: {{ slide.heading_left }};transform: none;{% endif %}{% if slide.heading_width %}width: {{ slide.heading_width }};{% endif %}{% if slide.heading_height and slide.heading_height != 'auto' %}height: {{ slide.heading_height }};{% endif %}{% if slide.heading_bg %}background: {{ slide.heading_bg }};{% endif %}{% if slide.heading_font_size %}font-size: {{ slide.heading_font_size }};{% endif %}">{{ slide.heading|safe }}</div>
                    {% endif %}
                    {% if slide.text %}
                    <div class="story-text" style="{% if slide.text_bottom %}bottom: {{ slide.text_bottom }};{% endif %}{% if slide.text_left %}left: {{ slide.text_left }};transform: none;{% endif %}{% if slide.text_width %}width: {{ slide.text_width }};{% endif %}{% if slide.text_height and slide.text_height != 'auto' %}height: {{ slide.text_height }};{% endif %}{% if slide.text_bg %}background: {{ slide.text_bg }};{% endif %}{% if slide.text_font_size %}font-size: {{ slide.text_font_size }};{% endif %}">{{ slide.text|safe }}</div>
                    {% endif %}
                    {% if slide.learn_more_url %}
                    <a href="{{ slide.learn_more_url }}" class="story-link" target="_blank" rel="noopener">
                        Learn More <i class="fas fa-arrow-right"></i>
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            {% endfor %}

            <!-- Navigation Areas -->
            <div class="story-navigation nav-prev" onclick="previousSlide()"></div>
            <div class="story-navigation nav-next" onclick="nextSlide()"></div>
            {% else %}
            <div class="story-slide active gradient-bg">
                <div class="story-header">
                    <button class="story-close" onclick="window.location.href='{{ url_for('public_webstories') }}'">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="story-content">
                    <div class="story-heading">{{ webstory.meta_title }}</div>
                    <div class="story-text">{{ webstory.meta_description }}</div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        let currentSlide = 0;
        const slides = document.querySelectorAll('.story-slide');
        const progressBars = document.querySelectorAll('.progress-bar');
        const loadingScreen = document.getElementById('loadingScreen');
        let autoPlayTimer;
        let isPaused = false;
        let progressStartTime = 0;
        let progressElapsed = 0;
        const SLIDE_DURATION = 5000; // 5 seconds per slide

        // Hide loading screen after page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
            }, 500);
        });

        function showSlide(index, resumeProgress = false) {
            // Hide all slides
            slides.forEach(slide => slide.classList.remove('active'));
            progressBars.forEach(bar => bar.classList.remove('active'));

            // Show current slide
            if (index >= 0 && index < slides.length) {
                currentSlide = index;
                slides[currentSlide].classList.add('active');
                progressBars[currentSlide].classList.add('active');

                // Mark previous slides as completed
                progressBars.forEach((bar, i) => {
                    if (i < currentSlide) {
                        bar.classList.add('completed');
                    } else {
                        bar.classList.remove('completed');
                    }
                });

                // Reset or resume progress animation
                const progressFill = progressBars[currentSlide].querySelector('.progress-fill');

                if (resumeProgress && progressElapsed > 0) {
                    // Resume from where we left off
                    const remainingTime = SLIDE_DURATION - progressElapsed;
                    const progressPercent = (progressElapsed / SLIDE_DURATION) * 100;
                    progressFill.style.animation = 'none';
                    progressFill.style.width = progressPercent + '%';
                    setTimeout(() => {
                        progressFill.style.transition = `width ${remainingTime}ms linear`;
                        progressFill.style.width = '100%';
                    }, 10);

                    // Set timer for remaining time
                    clearTimeout(autoPlayTimer);
                    if (!isPaused) {
                        progressStartTime = Date.now() - progressElapsed;
                        autoPlayTimer = setTimeout(() => {
                            progressElapsed = 0;
                            if (currentSlide < slides.length - 1) {
                                nextSlide();
                            } else {
                                setTimeout(() => {
                                    window.location.href = '{{ url_for("public_webstories") }}';
                                }, 1000);
                            }
                        }, remainingTime);
                    }
                } else {
                    // Fresh start
                    progressElapsed = 0;
                    progressFill.style.transition = '';
                    progressFill.style.animation = 'none';
                    progressFill.style.width = '0%';
                    setTimeout(() => {
                        progressFill.style.animation = `progress ${SLIDE_DURATION}ms linear forwards`;
                    }, 10);

                    // Auto advance after duration
                    clearTimeout(autoPlayTimer);
                    if (!isPaused) {
                        progressStartTime = Date.now();
                        autoPlayTimer = setTimeout(() => {
                            progressElapsed = 0;
                            if (currentSlide < slides.length - 1) {
                                nextSlide();
                            } else {
                                setTimeout(() => {
                                    window.location.href = '{{ url_for("public_webstories") }}';
                                }, 1000);
                            }
                        }, SLIDE_DURATION);
                    }
                }
            }
        }

        function pauseStory() {
            if (!isPaused) {
                isPaused = true;
                clearTimeout(autoPlayTimer);

                // Calculate elapsed time
                if (progressStartTime > 0) {
                    progressElapsed = Date.now() - progressStartTime;
                }

                // Pause the progress bar animation
                const progressFill = progressBars[currentSlide].querySelector('.progress-fill');
                const computedStyle = window.getComputedStyle(progressFill);
                const currentWidth = computedStyle.width;
                progressFill.style.animation = 'none';
                progressFill.style.transition = 'none';
                progressFill.style.width = currentWidth;
            }
        }

        function resumeStory() {
            if (isPaused) {
                isPaused = false;
                showSlide(currentSlide, true); // Resume with existing progress
            }
        }

        function nextSlide() {
            progressElapsed = 0;
            if (currentSlide < slides.length - 1) {
                showSlide(currentSlide + 1);
            } else {
                window.location.href = '{{ url_for("public_webstories") }}';
            }
        }

        function previousSlide() {
            progressElapsed = 0;
            if (currentSlide > 0) {
                showSlide(currentSlide - 1);
            }
        }

        // Click navigation on the story container
        const storyContainer = document.querySelector('.story-container');
        let clickStartTime = 0;
        let isHolding = false;

        storyContainer.addEventListener('click', (e) => {
            // Don't trigger if clicking on close button, learn more link, or any anchor tag
            if (e.target.closest('.story-close') || e.target.closest('.story-link') || e.target.closest('a') || e.target.tagName === 'A') {
                return;
            }

            // If it was a hold (long press), don't navigate
            if (isHolding) {
                isHolding = false;
                return;
            }

            const rect = storyContainer.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const containerWidth = rect.width;

            // If story is paused, navigate on click
            if (isPaused) {
                // If clicked on left 30%, go to previous slide
                if (clickX < containerWidth * 0.3) {
                    isPaused = false;
                    previousSlide();
                }
                // If clicked on right 70%, go to next slide
                else {
                    isPaused = false;
                    nextSlide();
                }
            } else {
                // Story is playing - pause it on first click
                pauseStory();
            }
        });

        // Pause on hold (desktop)
        storyContainer.addEventListener('mousedown', (e) => {
            if (e.target.closest('.story-close') || e.target.closest('.story-link') || e.target.closest('a') || e.target.tagName === 'A') {
                return;
            }
            clickStartTime = Date.now();
        });

        storyContainer.addEventListener('mouseup', (e) => {
            // Check if it was a hold (more than 200ms)
            if (Date.now() - clickStartTime > 200) {
                isHolding = true;
                // If was paused by hold, resume
                if (isPaused) {
                    resumeStory();
                }
            }
        });

        // Pause on hold (mobile)
        let touchStartTime = 0;
        storyContainer.addEventListener('touchstart', (e) => {
            if (e.target.closest('.story-close') || e.target.closest('.story-link') || e.target.closest('a') || e.target.tagName === 'A') {
                return;
            }
            touchStartTime = Date.now();

            // Pause after short delay (for hold gesture)
            setTimeout(() => {
                if (Date.now() - touchStartTime >= 150) {
                    pauseStory();
                }
            }, 150);
        }, { passive: true });

        storyContainer.addEventListener('touchend', (e) => {
            const touchDuration = Date.now() - touchStartTime;

            // If it was a hold (more than 200ms), resume
            if (touchDuration > 200) {
                isHolding = true;
                if (isPaused) {
                    resumeStory();
                }
            }
        }, { passive: true });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') {
                previousSlide();
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextSlide();
            } else if (e.key === 'Escape') {
                window.location.href = '{{ url_for("public_webstories") }}';
            }
        });

        // Touch swipe support
        let touchStartX = 0;
        let touchEndX = 0;
        let touchStartY = 0;
        let touchEndY = 0;

        storyContainer.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }, { passive: true });

        storyContainer.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            touchEndY = e.changedTouches[0].screenY;
            handleSwipe();
        }, { passive: true });

        function handleSwipe() {
            const swipeDistanceX = touchEndX - touchStartX;
            const swipeDistanceY = touchEndY - touchStartY;

            // Only register swipe if horizontal movement is greater than vertical
            if (Math.abs(swipeDistanceX) > Math.abs(swipeDistanceY)) {
                if (swipeDistanceX < -50) {
                    // Swipe left - next slide
                    nextSlide();
                } else if (swipeDistanceX > 50) {
                    // Swipe right - previous slide
                    previousSlide();
                }
            }
        }

        // Start the story
        showSlide(0);

        // Navigation dropdown toggle
        function toggleNavDropdown() {
            const dropdown = document.getElementById('navDropdown');
            if (dropdown) {
                dropdown.classList.toggle('visible');
                // Pause story when dropdown is open
                if (dropdown.classList.contains('visible')) {
                    pauseStory();
                } else {
                    resumeStory();
                }
            }
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('navDropdown');
            const navBtn = document.getElementById('navMenuBtn');
            if (dropdown && dropdown.classList.contains('visible')) {
                if (!dropdown.contains(e.target) && !navBtn.contains(e.target)) {
                    dropdown.classList.remove('visible');
                    resumeStory();
                }
            }
        });

        // Scroll to Top Button
        const scrollToTopBtn = document.getElementById('scrollToTopBtn');
        if (scrollToTopBtn) {
            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 300) {
                    scrollToTopBtn.classList.remove('opacity-0', 'invisible');
                    scrollToTopBtn.classList.add('opacity-100', 'visible');
                } else {
                    scrollToTopBtn.classList.remove('opacity-100', 'visible');
                    scrollToTopBtn.classList.add('opacity-0', 'invisible');
                }
            });

            scrollToTopBtn.addEventListener('click', function() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        }
    </script>

    <!-- Scroll to Top Button -->
    <button id="scrollToTopBtn" class="fixed bottom-8 right-8 z-50 w-12 h-12 bg-gradient-to-r from-primary-600 to-secondary-600 text-white rounded-full shadow-lg hover:shadow-xl transform hover:scale-110 transition-all duration-300 opacity-0 invisible flex items-center justify-center" title="Go to top">
        <i class="fas fa-arrow-up text-lg"></i>
    </button>
</body>
</html>